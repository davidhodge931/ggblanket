---
title: "ggblanket"
author: "David Hodge"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ggblanket}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 6,
  fig.asp = 0.6,
  out.width = "70%",
  dpi = 300
)
```

## Overview

ggblanket is a package of ggplot2 wrapper functions.

The primary objective is to **simplify ggplot2 visualisation**.

Secondary objectives relate to:

* Design: produce well-designed visualisation
* Alignment: align with ggplot2 and tidyverse
* Scope: cover much of what ggplot2 does.

Computational speed has been traded-off.

## How it works

1.  First setup with `set_blanket()`
2.  Each `gg_*` function wraps a geom
3.  A `col` aesthetic representing both colour and fill
4.  A `facet` argument to facet by a variable
5.  A `facet2` argument to facet by a 2nd variable
6.  All other aesthetics supported
7.  Prefixed arguments to customise
8.  Smart `*_title` defaults for axis and legend titles
9.  Other `ggplot2::geom_*` arguments via `...`
10. `theme_lighter` and `theme_darker` themes 
11. Set and forget with `set_blanket()`
12. An `aspect` for vertical/horizontal ease 
13. A `*_limits_to_breaks` continuous scale
14. A `bordered` style 
15. A `gg_blanket()` function with `geom` flexibility

```{r setup}
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(scales)
library(ggblanket)
library(palmerpenguins)
library(patchwork)
```

### 1. First setup with `set_blanket()`

The `set_blanket()` function should be run first. 

This sets the default style of plots with themes and colours etc. It can be customised. 

It should be run at the start of every script or quarto document. 

```{r}
set_blanket()
```

### 2. Each `gg_*` function wraps a geom

Each `gg_*` function wraps a `ggplot2::ggplot()` function with the associated `ggplot2::geom_*()` function. 

Almost every geom in ggplot2 is wrapped. 

Position related aesthetics can be added directly as arguments. 

```{r}
palmerpenguins::penguins |>
  gg_point(
    x = flipper_length_mm,
    y = body_mass_g,
  )
```

### 3.  A `col` aesthetic representing both colour and fill

In ggplot2, the `col` aesthetic is shorthand for the `colour` aesthetic.

In ggblanket, the `col` aesthetic represents *both* the `colour` *and* the `fill` aesthetic. 

The `col` argument is the variable to map the `colour` and `fill` aesthetics. 

```{r}
palmerpenguins::penguins |>
  drop_na(sex) |> 
  gg_violin(
    x = flipper_length_mm,
    y = island,
    col = sex, 
  )
```

### 4. A `facet` argument to facet by a variable

Users provide an unquoted `facet` variable to facet by. 

When `facet` is specified, the `facet_layout` will default to a `"wrap"` of the `facet` variable (if `facet2 = NULL`).

```{r}
palmerpenguins::penguins |>
  gg_histogram(
    x = flipper_length_mm,
    facet = species,
  )
```

### 5. A `facet2` argument to facet by a 2nd variable

Users can also provide an unquoted `facet2` variable to facet by.

When `facet2` is specified, the `facet_layout` will default to a `"grid"` of the `facet` variable (horizontally) by the `facet2` variable (vertically).

```{r, fig.asp=0.75}
palmerpenguins::penguins |>
  gg_histogram(
    x = flipper_length_mm,
    facet = species,
    facet2 = sex,
  )
```

### 6. All other aesthetics supported

Other aesthetics are available: `alpha`, `size`, `shape`, `linetype` and `linewidth`. These can be either mapped as an aesthetic, or set to a value. 

```{r}
palmerpenguins::penguins |> 
  drop_na(sex) |> 
  gg_jitter(
    x = species, 
    y = flipper_length_mm, 
    col = island,
    shape = island,
  ) 
```

### 7.  Prefixed arguments to customise

There are numerous arguments to customise plots that are prefixed by whether they relate to `x`, `y`, `col` or `facet`. 

For `x`, `y` and `col`, these relate to associated arguments within ggplot2 scales and guides. For `facet`, they relate to associated arguments within `ggplot2::facet_wrap` and `ggplot2::facet_grid`. 

Scales and guides associated with other other aesthetics can be customised by adding the applicable ggplot2 layer. 

```{r}
palmerpenguins::penguins |>
  gg_jitter(
    x = flipper_length_mm,
    y = body_mass_g,
    col = bill_length_mm,
    x_breaks_n = 4,
    x_title = "Flipper length",
    x_labels = \(x) paste0(x, " mm"),
    y_limits_include = 1000,
    y_labels = label_number(big.mark = " "), 
    y_transform = "sqrt",
    col_title = "Bill\nlength (mm)",
    col_breaks = \(x) quantile(x, seq(0, 1, 0.25)),
  )
```

### 8.  Smart `*_title` defaults for axis and legend titles

The `x_title`, `y_title` and `col_title` for the axis and legend titles can be manually specified with the applicable `*_title` argument. All other titles will need to use `+ ggplot2::labs(...)`. 

If titles are not specified, they will first take any label attribute associated with the applicable variable. If no label attribute, they will then convert the variable name to a label name using the `titles_case` function, which defaults to sentence case. 

```{r, fig.asp=0.6}
palmerpenguins::penguins |>
  gg_freqpoly(
    x = flipper_length_mm,
    col = species,
  )
```

### 9. Other `ggplot2::geom_*` arguments via `...`

The `...` argument provides access to all other arguments in the `ggplot2::geom_*()` function. 

Use the `ggplot2::geom_*` help to see what arguments are available. 

```{r}
palmerpenguins::penguins |>
  gg_smooth(
    x = flipper_length_mm,
    y = body_mass_g,
    level = 0.999, #argument accessed via ...
  ) 
```

### 10.  `theme_lighter` and `theme_darker` themes 

`theme_lighter` and `theme_darker`. 

These functions were built for use within `set_blanket`, as then `bordered_colour` and `bordered_fill` adjustments can apply based on these (e.g. if the panel is dark). 

```{r, fig.asp=0.65}
set_blanket(theme = theme_darker())
      
palmerpenguins::penguins |>
  gg_histogram(
    x = flipper_length_mm,
    col = species,
    title = "Penguin flipper length by species",
    subtitle = "Palmer Archipelago, Antarctica",
    caption = "Source: Gorman, 2020", 
  ) 

set_blanket()
```

### 11. Set and forget with `set_blanket()`

The `set_blanket` function sets customisable defaults. This function should be run first prior to any `gg_*` functions. This function is for setting a consistent style. Users should try to do as much as possible in this function, rather than continually add arguments to `gg_*` functions. 

```{r}
set_blanket(
  theme = theme_lighter(
      base_size = 9,
      legend_position = "top",
      axis_line_linewidth = 0.25, 
      axis_line_colour = "#78909C",
      panel_grid_colour = "#C8D7DF",
      panel_background_fill = "#E8EFF2",
      panel_grid_linewidth = 0.25, 
  ),
  col = "tan", 
  col_palette_d = c("#003f5c", "#bc5090", "#ffa600", "#357BA2"),
)

p1 <- palmerpenguins::penguins |>
  gg_point(
    x = bill_depth_mm, 
    y = flipper_length_mm,
  ) 

p2 <- palmerpenguins::penguins |> 
  gg_bar(
    y = sex,
    col = species,
    position = "dodge",
  ) 

p1 + p2

set_blanket()
```

### 12. An `aspect` for vertical/horizontal ease 

The `aspect` parameter describes the intended way that a person would look at a plot - and then applies the `aspect_axis_line`, `aspect_axis_ticks` and `aspect_panel_grid` behaviour to the plot.

The intention for this is to enable asymmetric axis lines, ticks and gridlines for vertical and horizontal plots using a single theme.

The default behaviour from `set_blanket` is to make transparent one direction of axis lines, axis ticks and panel grid theme elements in accordance with the `"aspect"`.  


```{r}
set_blanket(
  theme = theme_lighter(
    panel_grid_colour = "#003F5CFF", 
  )
)

p1 <- palmerpenguins::penguins |>
  drop_na() |>
  gg_jitter(
    x = sex,
    y = bill_depth_mm,
    col = sex,
  ) +
  labs(x = NULL)

p2 <- palmerpenguins::penguins |>
  drop_na() |>
  gg_jitter(
    x = bill_depth_mm,
    y = sex,
    col = sex,
  ) 

p1 / p2
```

### 13. A `*_limits_to_breaks` continuous scale

A `*_limits_to_breaks` continuous scale can look good. 

This refers to when the limits equals the range of the `*_breaks`. Where `*_limits_to_breaks = TRUE`, the NULL `*_expand` equals `c(0, 0)` instead of `ggplot2::waiver()`.

The NULL `*_limits_to_breaks`is larglely determined by the `aspect` of the plot. Where `aspect = 'x'`, then by default `x_limits_to_breaks = FALSE` and `y_limits_to_breaks = TRUE`. For `aspect = 'y'`, the vice versa occurs.

Note all continuous scales ensure all data is kept using `scales::oob_keep` - and, by default, are unclipped (i.e. `coord_cartesian(clip = "off")`. 

### 14. A `bordered` style 

Certain geoms are classified as bordered (e.g. bar, area, tile, polygon etc). Point geoms with shapes 21-25 are also considered bordered. 

This classification determines whether border logic applies to the underlying colour/fill and equivalent palettes for these aesthetics. By default bordered polygons are applied a multiply blending of their colour to itself, and fill is left unchanged. 

Use `bordered = FALSE` to turn this off within the `gg_*` function, or `set_blanket(bordered_colour = \(x) x, bordered_fill = \(x) x, ...)`.

```{r}
set_blanket(
  theme = theme_lighter(),
  bordered_colour = \(x) scales::col_darker(x, amount = 40),
  bordered_linewidth = 0.5,
)
  
palmerpenguins::penguins |> 
  gg_violin(
    x = species,
    y = body_mass_g,
    col = sex,
  )
```

### 15. A `gg_blanket()` function with `geom` flexibility

The package is driven by the `gg_blanket` function, which has a `geom` argument with `ggplot2::geom_blank` defaults for `geom`, `stat` and `position`.

All other functions wrap this function with a fixed `geom`, and their own default `stat` and `position` arguments as per the applicable `geom_*` function.

This function can often be used (1) where an alternative geom or annotation is needed to be plotted first, or (2) where a geom is needed to be plotted that is not provided in a `gg_*` function.

Note bordered colouring/filling only passes through to `+ geom_` layers for mapped `col` aesthetics. Use `col_multiply` and `col_screen`, if you want to replicate the default ggblanket look for where `col` is not mapped.

```{r}
palmerpenguins::penguins |>
  drop_na() |> 
  gg_blanket(
    x = flipper_length_mm,
    y = body_mass_g,
    size = bill_length_mm,
    shape = sex,
    bordered = TRUE,
  ) +
  annotate("rect", 
           xmin = I(0.9), xmax = Inf,
           ymin = -Inf, ymax = Inf,
           colour = NA,
           fill = jumble[9]) +
  geom_point(colour = col_multiply(jumble[11]))
```

```{r}
set_blanket()
geom_spoke()

expand.grid(x = 1:10, y = 1:10) |>
  tibble() |>
  mutate(angle = runif(100, 0, 2*pi)) |>
  mutate(speed = runif(100, 0, sqrt(0.1 * x))) |>
  gg_blanket(
    geom = "spoke",
    x = x, 
    y = y,
    col = speed,
    mapping = aes(angle = angle, radius = speed),
  ) +
  geom_point()
```

## Further information 

See the ggblanket [website](https://davidhodge931.github.io/ggblanket/index.html) for further information, including [articles](https://davidhodge931.github.io/ggblanket/articles/) and [function reference](https://davidhodge931.github.io/ggblanket/reference/index.html).
